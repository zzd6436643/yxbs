package org.jzw.yxbs.service.impl;import javax.annotation.Resource;import org.apache.commons.lang3.StringUtils;import org.apache.log4j.Logger;import org.jzw.yxbs.condition.UserInfoCondition;import org.jzw.yxbs.dao.IndexDao;import org.jzw.yxbs.dao.UserMgrDao;import org.jzw.yxbs.domain.UserInfo;import org.jzw.yxbs.service.IndexService;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;@Service("indexService")public class IndexServiceImpl implements IndexService {	private static final Logger LOGGER = Logger.getLogger(IndexServiceImpl.class);		@Resource	private IndexDao indexDao;		@Resource	private UserMgrDao userMgrDao;	@Override	public String getLastLoginTime(String username) {		try {			UserInfoCondition userInfo = new UserInfoCondition();			userInfo.setUsername(username);			userInfo.setUserInfoAttrid("LASTLOGIN");			return userMgrDao.findUserAttributeVal(userInfo);		} catch (Exception e) {			LOGGER.error("service错误：", e);			throw new RuntimeException("service错误：",e);		}	}	@Override	@Transactional(rollbackFor = Exception.class)	public void updateLastLoginTime(String username) {		try {			UserInfoCondition userInfoCondition = new UserInfoCondition();			UserInfo userInfo = new UserInfo();			userInfoCondition.setUsername(username);			userInfoCondition.setUserInfoAttrid("THISLOGIN");			String thisLoginTime = userMgrDao.findUserAttributeVal(userInfoCondition);						if (StringUtils.isEmpty(thisLoginTime)) {				userInfo.setUsername(username);				userInfo.setUserInfoAttrid("THISLOGIN");				userMgrDao.insertNewUserDefaultLoginTime(userInfo);				userInfo.setUserInfoAttrid("LASTLOGIN");				userMgrDao.insertNewUserInfo(userInfo);			} else {				userInfo.setUsername(username);				userInfo.setUserInfoAttrid("LASTLOGIN");				userInfo.setUserInfoAttrval(thisLoginTime);				userMgrDao.updateUserAttributeVal(userInfo);				userInfo.setUserInfoAttrid("THISLOGIN");				String dbCurrentTime = indexDao.findDBCurrentTime();				userInfo.setUserInfoAttrval(dbCurrentTime);				userMgrDao.updateUserAttributeVal(userInfo);			}		} catch (Exception e) {			LOGGER.error("service错误：", e);			throw new RuntimeException("service错误：",e);		}	}		}