package org.jzw.yxbs.service.impl;import java.util.Date;import javax.annotation.Resource;import org.apache.commons.lang3.StringUtils;import org.apache.log4j.Logger;import org.jzw.yxbs.condition.UserInfoCondition;import org.jzw.yxbs.dao.IndexDao;import org.jzw.yxbs.service.IndexService;import org.jzw.yxbs.utils.DateFormatUtil;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;@Service("indexService")public class IndexServiceImpl implements IndexService {	private static final Logger LOGGER = Logger.getLogger(IndexServiceImpl.class);		@Resource	private IndexDao indexDao;	@Override	public String getLastLoginTime(String username) {		try {			UserInfoCondition userInfo = new UserInfoCondition();			userInfo.setUsername(username);			userInfo.setUserInfoid("LASTLOGIN");			return indexDao.getUserAttributeVal(userInfo);		} catch (Exception e) {			LOGGER.error("service错误：", e);			throw new RuntimeException("service错误：",e);		}	}	@Override	@Transactional(rollbackFor = Exception.class)	public void updateLastLoginTime(String username) {		try {			UserInfoCondition userInfo = new UserInfoCondition();			userInfo.setUsername(username);			userInfo.setUserInfoid("THISLOGIN");			String thisLoginTime = indexDao.getUserAttributeVal(userInfo);			if (StringUtils.isEmpty(thisLoginTime)) {				indexDao.insertNewUserThisLoginTime(userInfo);				userInfo.setUserInfoid("LASTLOGIN");				indexDao.insertNewUserInfo(userInfo);			} else {				userInfo.setUserInfoid("LASTLOGIN");				userInfo.setUserInfoval(thisLoginTime);				indexDao.updateUserAttributeVal(userInfo);				userInfo.setUserInfoid("THISLOGIN");				userInfo.setUserInfoval(DateFormatUtil.dateToString(new Date(),"yyyy-MM-dd HH:mm:ss"));				indexDao.updateUserAttributeVal(userInfo);			}		} catch (Exception e) {			LOGGER.error("service错误：", e);			throw new RuntimeException("service错误：",e);		}	}		}